<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-02-17 Wed 10:45 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RVprio: Analyzing a Prioritized List of Violations from a RV tool</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Lucas Costa Cabral" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">RVprio: Analyzing a Prioritized List of Violations from a RV tool</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org6d139e5">1. Setting docker up</a></li>
<li><a href="#orgc1a341c">2. Picking a toy project</a></li>
<li><a href="#org10f789d">3. Using RVprio</a></li>
<li><a href="#orgbad912c">4. Working with violations</a>
<ul>
<li><a href="#orgad6b16e">4.1. Violation</a></li>
<li><a href="#org99b6455">4.2. Read the Specification</a></li>
<li><a href="#org64ef425">4.3. Fixing Violations</a></li>
<li><a href="#orgd18741d">4.4. Submitting Corrections</a></li>
</ul>
</li>
<li><a href="#org8db2924">5. Conclusion</a></li>
</ul>
</div>
</div>
<p>
<a href="https://github.com/STAR-RG/rvprio">RVprio</a> is a tool that aims to enchance the usuability of Runtime Verification (RV) tools by
sorting violations by its likeability to be bugs, which ultimately saves developers time.
</p>

<p>
This tutorial will focus on the <a href="http://fsl.cs.illinois.edu/index.php/JavaMOP4">JavaMOP</a> RV framework, built around the Java programming language.
</p>

<p>
While JavaMOP offers the whole structure for RV, it can be a little rough around the edges, this article hopes to help you on working more effectively with JavaMOP.
</p>

<p>
This article assumes you are familiar with:
</p>
<ul class="org-ul">
<li>CLIs</li>
<li><a href="https://www.docker.com/">Docker</a></li>
</ul>
<p>
and that you are using a unix-based operating system.
</p>

<p>
&gt; <span class="underline"><b><b>Note</b></b>: the properties used in this article are properties from the Java API, if you  wish to configure JavaMOPs properties take a look at <a href="https://github.com/runtimeverification/javamop/blob/master/docs/JavaMOPAgentUsage.md">building your own agent</a>.</span>
</p>

<div id="outline-container-org6d139e5" class="outline-2">
<h2 id="org6d139e5"><span class="section-number-2">1</span> Setting docker up</h2>
<div class="outline-text-2" id="text-1">
<p>
In my past experience setting up the environment for JavaMOP can be a bit tedious as one must manage dependencies and build the Java agent by hand to only then use the tooling.
In order to simplify this process a docker container with all the dependencies and sensible defaults for a working environment has been provided, and it&rsquo;s HIGHLY recommended to use it.
</p>

<p>
This tutorial assumes you are using the Dockerfile but if you wish to configure the environment yourself the README on <a href="https://github.com/runtimeverification/javamop">JavaMOP GitHub</a> is pretty much self explanatory.
</p>

<p>
Now fire up a terminal and lets get started
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #5B6268;"># </span><span style="color: #5B6268;">check if docker is installed</span>
docker -v
</pre>
</div>

<p>
If you already have it installed, you should be greeted by something like this:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Docker version 19.03.13-ce</td>
<td class="org-left">build 4484c46d9d</td>
</tr>
</tbody>
</table>

<p>
If you don&rsquo;t seem to have docker installed please refer to the <a href="https://docs.docker.com/get-docker/">docker documentation</a>.
</p>

<p>
&gt; <span class="underline"><b><b>Note</b></b>: if you&rsquo;re using a Linux system, please take a look at <a href="https://docs.docker.com/engine/install/linux-postinstall/"> Docker&rsquo;s post-installation steps for Linux</a>!</span>
</p>

<p>
Now that docker is installed let&rsquo;s get down to business. <a href="https://hub.docker.com/">Docker Hub</a> is where open-source docker images are stored, to install our docker image simply run:
</p>
<div class="org-src-container">
<pre class="src src-shell">docker run lucasccabral/javamop-docker-image:latest
</pre>
</div>

<p>
If you followed all the steps in the previous session you should already have our docker container in your machine, if this is not the case please go back to the previous session.
</p>

<p>
Now lets enter our container
</p>
<div class="org-src-container">
<pre class="src src-shell">docker run -it lucasccabral/javamop-docker-image:latest
</pre>
</div>

<p>
and take a look at its contents
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">ls</span> -l
</pre>
</div>

<p>
the home dir for our docker container looks like this
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">total</td>
<td class="org-right">20</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">6</td>
<td class="org-left">mopuser</td>
<td class="org-left">mopuser</td>
<td class="org-right">4096</td>
<td class="org-left">Mar</td>
<td class="org-right">15</td>
<td class="org-right">2020</td>
<td class="org-left">DebuggingJavaMOPAgent.jar</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">6</td>
<td class="org-left">mopuser</td>
<td class="org-left">mopuser</td>
<td class="org-right">4096</td>
<td class="org-left">Mar</td>
<td class="org-right">15</td>
<td class="org-right">2020</td>
<td class="org-left">apache-maven</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">3</td>
<td class="org-left">mopuser</td>
<td class="org-left">mopuser</td>
<td class="org-right">4096</td>
<td class="org-left">Mar</td>
<td class="org-right">11</td>
<td class="org-right">2020</td>
<td class="org-left">mop-extension</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">13</td>
<td class="org-left">mopuser</td>
<td class="org-left">mopuser</td>
<td class="org-right">4096</td>
<td class="org-left">Mar</td>
<td class="org-right">15</td>
<td class="org-right">2020</td>
<td class="org-left">workspace</td>
</tr>
</tbody>
</table>
</div>
</div>


<div id="outline-container-orgc1a341c" class="outline-2">
<h2 id="orgc1a341c"><span class="section-number-2">2</span> Picking a toy project</h2>
<div class="outline-text-2" id="text-2">
<p>
For this example we will be using the <a href="https://struts.apache.org/">apache struts</a> project but you may choose any maven based project, the only advantage of using struts is that this tutorial has been geared towards it and we also provide a diff-file to change it&rsquo;s pom.xml.
</p>

<p>
Firstly, go to the workspace directory:
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">cd</span> workspace
</pre>
</div>

<p>
then clone the struts repository
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">git</span> clone https://github.com/apache/struts.git
</pre>
</div>

<p>
now enter the projects dir
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">cd</span> struts
</pre>
</div>

<p>
in order to avoid reproducibility issues we are going to use a specific hash, but the steps in this tutorial should hold for other hashes with minor tweakings being needed.
</p>

<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">git</span> checkout f2a3c3955ad2ea3c5af2a0791e504867fb32f66c
</pre>
</div>

<p>
now lets take a look at the directory files!
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">ls</span> -l
</pre>
</div>

<p>
the only file we care about is the `pom.xml`
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">total</td>
<td class="org-right">116</td>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-right">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">4</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">4096</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">apps</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">3</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">4096</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">assembly</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">2</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">4096</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">bom</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">4</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">4096</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">bundles</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">3</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">4096</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">core</td>
</tr>

<tr>
<td class="org-left">-rw-r&#x2013;r--</td>
<td class="org-right">1</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">6320</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">Jenkinsfile</td>
</tr>

<tr>
<td class="org-left">-rwxr-xr-x</td>
<td class="org-right">1</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">10069</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">mvnw</td>
</tr>

<tr>
<td class="org-left">-rw-r&#x2013;r--</td>
<td class="org-right">1</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">6607</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">mvnw.cmd</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">29</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">4096</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">plugins</td>
</tr>

<tr>
<td class="org-left">-rw-r&#x2013;r--</td>
<td class="org-right">1</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">48543</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">pom.xml</td>
</tr>

<tr>
<td class="org-left">-rw-r&#x2013;r--</td>
<td class="org-right">1</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">7622</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">README.md</td>
</tr>

<tr>
<td class="org-left">-rw-r&#x2013;r--</td>
<td class="org-right">1</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">1727</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">SECURITY.md</td>
</tr>

<tr>
<td class="org-left">drwxr-xr-x</td>
<td class="org-right">5</td>
<td class="org-left">lucas</td>
<td class="org-left">lucas</td>
<td class="org-right">4096</td>
<td class="org-left">Nov</td>
<td class="org-right">19</td>
<td class="org-right">20:19</td>
<td class="org-left">src</td>
</tr>
</tbody>
</table>


<p>
&gt; <span class="underline">Note: A <a href="https://github.com/runtimeverification/javamop/blob/master/docs/JavaMOPAgentUsage.md">pretty good explanation</a> on how to add our java agent to a maven based project on the JavaMOP repository, so we are not going to explain this step by step here.</span>
</p>

<p>
Instead we provide a diff file that you can apply to the struts project!
</p>

<p>
download the patch for the STRUTS project
</p>
<div class="org-src-container">
<pre class="src src-shell">wget https://gist.githubusercontent.com/lcc/14190d59fd434b4094e0473774abf334/raw/ea2a0a69551054e12d6e3ce84c2653865f9e68b2/struts-javamop.diff
</pre>
</div>

<p>
apply it to you local dir
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">git</span> apply struts-javamop.diff
</pre>
</div>

<p>
and to see the changes made by our diff run
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">git</span> diff
</pre>
</div>

<p>
&gt; <span class="underline"><b><b>Note</b></b>:If you are not using our docker container we strongly recommend you add  `export RVMLOGGINGLEVEL=UNIQUE` to your shell configuration file (e.g. bashrc).
This is important as instead of outputting the violations to the stdout with the output of all the tests, the violations will be held in files named violation-counts.</span>
</p>

<p>
There is one last thing you should do before running any tests&#x2026; The struts repository has a few tests that hang, so the `mvn test` command would run indefinetely, in order to remove such tests copy and run the following command:
</p>
<div class="org-src-container">
<pre class="src src-shell"><span style="color: #ECBE7B;">find</span> .  -name <span style="color: #98be65;">"ActionsFromSpringTest.java"</span> -o <span style="color: #98be65;">\</span>
-name <span style="color: #98be65;">"SpringObjectFactoryTest.java"</span> -o <span style="color: #98be65;">\</span>
-name <span style="color: #98be65;">"SpringProxyUtilTest.java"</span> -o <span style="color: #98be65;">\</span>
-name <span style="color: #98be65;">"SecurityMemberAccessProxyTest.java"</span> -o <span style="color: #98be65;">\</span>
-name <span style="color: #98be65;">"FreemarkerThemeTemplateLoaderTest.java"</span> -o <span style="color: #98be65;">\</span>
-name <span style="color: #98be65;">"TagModelTest.java"</span> -o <span style="color: #98be65;">\</span>
-name <span style="color: #98be65;">"ExecuteAndWaitInterceptorTest.java"</span> | xargs <span style="color: #ECBE7B;">rm</span> -f
</pre>
</div>

<p>
Now we are all set, simply run:
</p>
<div class="org-src-container">
<pre class="src src-shell">mvn test -fn -e &gt; struts.log
</pre>
</div>
<p>
&gt; <span class="underline"><b><b>Note</b></b>: the flags -fn and -e are needed as some tests in the struts rep fail or end in errors, theses flags simply tell to continue running the tests.</span>
</p>

<p>
And the tests should be running with the JavaMOP agent, now you just have to sit and wait, run-time will depend on the specs of the machine but on mine it took ~30min.
</p>
</div>
</div>

<div id="outline-container-org10f789d" class="outline-2">
<h2 id="org10f789d"><span class="section-number-2">3</span> Using RVprio</h2>
<div class="outline-text-2" id="text-3">
<p>
Once the tests finish running we ought to find some violations!
If you correctly followed all the steps all the violations should be in the struts.log file.
</p>

<p>
Even though the violations are inside the file this is not easy to use, but fear not, rvprio to the rescue!
</p>

<p>
RVprio is a tool for prioritizing runtime verification violations and as a plus it also parses log files and finds and parses
violations for us. Lets take a look at its interface.
</p>

<div class="org-src-container">
<pre class="src src-shell">rvprio.py -h
</pre>
</div>


<p>
Explaining the flags:
</p>
<ul class="org-ul">
<li>k: kernel, the tool used to produce violations, in this particular case we don&rsquo;t need to set it as JavaMOP is the default.</li>
<li>p: the name of the current project, in this case, struts</li>
<li>i: name of the file that has the logs info, in this case, struts.log</li>
<li>o: the output file for rvprio</li>
</ul>

<p>
So in our case the command to run rvprio would be
</p>

<div class="org-src-container">
<pre class="src src-shell">rvprio -p struts -i struts.log -o struts.csv
</pre>
</div>

<p>
and after a few seconds if you take a look at your directory, you should have a file named struts.csv with the violations inside it.
</p>
</div>
</div>

<div id="outline-container-orgbad912c" class="outline-2">
<h2 id="orgbad912c"><span class="section-number-2">4</span> Working with violations</h2>
<div class="outline-text-2" id="text-4">
<p>
In the previous section we generated a dataset of violations for found files, in this section we plan to demonstrate how to use our brand new dataset.
</p>

<p>
First things first, a violation can be categorized as a bug or as a false alarm.
A bug is a software failure, an erroneous or incorrect state that shouldn&rsquo;t exist at runtime and a false alarm is a false violation, the violation shouldn&rsquo;t have been triggered, but by some mistake (or limitation) of the tooling, the violation occurred.
</p>
</div>


<div id="outline-container-orgad6b16e" class="outline-3">
<h3 id="orgad6b16e"><span class="section-number-3">4.1</span> Violation</h3>
<div class="outline-text-3" id="text-4-1">
<p>
We must choose one violations of the remaining to inspect.
</p>
</div>
</div>

<div id="outline-container-org99b6455" class="outline-3">
<h3 id="org99b6455"><span class="section-number-3">4.2</span> Read the Specification</h3>
<div class="outline-text-3" id="text-4-2">
<p>
In this step we try to understand what causes the violation so we can evaluate whether the violation is a bug or a false positive.
</p>

<p>
Each violation is associated with a formal specification, for instance, the violation Closeable\<sub>MeaninglessClose</sub> is associated with the following description
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #83898d;">/**</span>
<span style="color: #83898d;"> * Warns if meaningless close() is invoked.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * In several classes, close(), specified in Closeable interface, has no</span>
<span style="color: #83898d;"> * effect and other methods in those classes can be called after close()</span>
<span style="color: #83898d;"> * without IOException. In OpenJDK 6's java.io package, the following classes</span>
<span style="color: #83898d;"> * have such meaningless close():</span>
<span style="color: #83898d;"> *  ByteArrayInputSteram</span>
<span style="color: #83898d;"> *   http://download.oracle.com/javase/6/docs/api/java/io/ByteArrayInputStream.html#close()</span>
<span style="color: #83898d;"> *  ByteArrayOutputStream</span>
<span style="color: #83898d;"> *   http://download.oracle.com/javase/6/docs/api/java/io/ByteArrayOutputStream.html#close()</span>
<span style="color: #83898d;"> *  CharArrayWriter</span>
<span style="color: #83898d;"> *   http://download.oracle.com/javase/6/docs/api/java/io/CharArrayWriter.html#close%28%29</span>
<span style="color: #83898d;"> *  StringWriter</span>
<span style="color: #83898d;"> *   http://download.oracle.com/javase/6/docs/api/java/io/StringWriter.html#close%28%29</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * This specification warns when such meaningless close() is invoked, in the</span>
<span style="color: #83898d;"> * hope that it helps the user to understand the actual behavior.</span>
<span style="color: #83898d;"> *</span>
<span style="color: #83898d;"> * </span><span style="color: #a9a1e1;">@severity</span><span style="color: #83898d;"> suggestion</span>
<span style="color: #83898d;"> */</span>
</pre>
</div>

<p>
therefore, for each Closeable<sub>MeaninglessClose</sub> violation one must verify what class called the close method and if the violator class has an empty implementation of the close method.
</p>

<p>
Even though the specifications are different, the process of verification is the same, simply check the specification of the violation and the examine the source code to check if the violation really occurred.
</p>
</div>
</div>

<div id="outline-container-org64ef425" class="outline-3">
<h3 id="org64ef425"><span class="section-number-3">4.3</span> Fixing Violations</h3>
<div class="outline-text-3" id="text-4-3">
<p>
After inspecting the source and inferring that it&rsquo;s indeed a failure in software, the next step is to fix the violation.
In order to do this, one must, understand what caused the violation, change the source, run the tests and check whether the violation disappeared or not!
</p>

<p>
To better illustrate this process let&rsquo;s consider the following violation
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">InputStream</span> <span style="color: #c678dd;">getContent</span>() {
        <span style="color: #51afef;">if</span> (isSerializable()) {
                <span style="color: #51afef;">try</span> (<span style="color: #ECBE7B;">ByteArrayOutputStream</span> <span style="color: #dcaeea;">baos</span> = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">ByteArrayOutputStream</span>()) { <span style="color: #5B6268;">// </span><span style="color: #5B6268;">=======&gt; violation meaningless close</span>
                        writeTo(baos);
                        <span style="color: #51afef;">return</span> <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">ByteArrayInputStream</span>(baos.toByteArray());
                } <span style="color: #51afef;">catch</span> (<span style="color: #ECBE7B;">IOException</span> <span style="color: #dcaeea;">e</span>) {
                        <span style="color: #51afef;">throw</span> <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">RuntimeException</span>(e);
                }
        }
        <span style="color: #51afef;">return</span> <span style="color: #51afef;">super</span>.getContent();
}
</pre>
</div>

<p>
the line that causes the violation is the line with the try-with resources, for those that don&rsquo;t now, every resource that is declared inside the try with resources is closed after leaving the try block.
</p>

<p>
In order for a variable to be declared inside the try-with resources it must implement the <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/AutoCloseable.html">AutoCloseable</a>  which states &ldquo;An object that may hold resources (such as file or socket handles) until it is closed. The close() method of an AutoCloseable object is called automatically when exiting a try-with-resources block for which the object has been declared in the resource specification header. This construction ensures prompt release, avoiding resource exhaustion exceptions and errors that may otherwise occur.
&rdquo;.
</p>

<p>
ByteArrayOutputStream implements AutoCloseable and Closeable interfaces and it has an empty implementation of the close method, so this is in fact a violation.
</p>

<p>
a possible fix for this one is
</p>
<div class="org-src-container">
<pre class="src src-java"><span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">InputStream</span> <span style="color: #c678dd;">getContent</span>() {
        <span style="color: #51afef;">public</span> <span style="color: #ECBE7B;">InputStream</span> <span style="color: #c678dd;">getContent</span>() {
        <span style="color: #51afef;">if</span> (isSerializable()) {
                <span style="color: #ECBE7B;">ByteArrayOutputStream</span> <span style="color: #dcaeea;">baos</span> = <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">ByteArrayOutputStream</span>(); <span style="color: #5B6268;">// </span><span style="color: #5B6268;">=========&gt; fix</span>
                <span style="color: #51afef;">try</span> { <span style="color: #5B6268;">// </span><span style="color: #5B6268;">removed the file from the try-with resources</span>
                        writeTo(baos);
                        <span style="color: #51afef;">return</span> <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">ByteArrayInputStream</span>(baos.toByteArray());
                } <span style="color: #51afef;">catch</span> (<span style="color: #ECBE7B;">IOException</span> <span style="color: #dcaeea;">e</span>) {
                        <span style="color: #51afef;">throw</span> <span style="color: #51afef;">new</span> <span style="color: #ECBE7B;">RuntimeException</span>(e);
                }
        }
        <span style="color: #51afef;">return</span> <span style="color: #51afef;">super</span>.getContent();
}
</pre>
</div>

<p>
and after this the violation disappeared and all test passed!
</p>

<p>
To look for the violations specifications you can look at <a href="https://runtimeverification.com/monitor/propertydb/__properties/property-list.html">propertydb.</a>
</p>
</div>
</div>

<div id="outline-container-orgd18741d" class="outline-3">
<h3 id="orgd18741d"><span class="section-number-3">4.4</span> Submitting Corrections</h3>
<div class="outline-text-3" id="text-4-4">
<p>
After corrected the fixes should be grouped in commits and submitted as PRs for their respective projects.
</p>

<p>
I inspected 12 projects and found 55 violations, but 24 couldn&rsquo;t be fixed as the project had been archived, which left me with 31 fixable violations. Of the 31, 8, haven&rsquo;t been revised yet, which leaves 24 reviewed patches.
</p>

<p>
After fixing and sending the patches, 75% (18) were accepted!
</p>
</div>
</div>
</div>


<div id="outline-container-org8db2924" class="outline-2">
<h2 id="org8db2924"><span class="section-number-2">5</span> Conclusion</h2>
<div class="outline-text-2" id="text-5">
<p>
If you followed all the steps correctly you should have a small dataset for inspection and should be capable of performing your own fixes and submitting patches!
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Lucas Costa Cabral</p>
<p class="date">Created: 2021-02-17 Wed 10:45</p>
</div>
</body>
</html>
